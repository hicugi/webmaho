var app=angular.module("app",["ngSanitize","ngRoute","ngTouch"]);for(k in template)template[k]=template[k]+"?"+templateTime;app.config(["$routeProvider","$locationProvider",function(e,t){t.html5Mode({enabled:!0,requireBase:!1}),e.otherwise({templateUrl:template.empty})}]),app.filter("range",function(){return function(e,t){for(t=parseInt(t),i=0;i<t;i++)e.push(i);return e}}),app.filter("setPhone",function(){return function(e){return e?e.replace(/\(|\)|\s|\-/g,""):""}}),app.filter("indexOf",function(){return function(e,t){return e?e.indexOf(t):""}}),app.filter("length",function(){return function(e){var t=0;if(e)for(k in e)t++;return t}}),app.filter("seperate",function(){return function(e,t){var a="",o=!1;if(e&&t)for(i=0;i<e.length;i++){var n=e[i];(-1!=["<",">"].indexOf(n)||o)&&(a+=n),"<"!=n?">"!=n?o||(a+="<"+t+">"+n+"</"+t+">"):o=!1:o=!0}return sr.trust.html(a)}}),app.directive("pluginInit",function(){return function(e,t,a){switch(a.pluginInit){case"maskPhone":if(void 0==$().mask){console.log("plugin.mask undefined");break}t.mask("+7 (999) 999 99 99");break;case"map":if(void 0==google)break;var o,n=new google.maps.Map(t[0],{zoom:16,center:new google.maps.LatLng(43.228293,76.899614),scrollwheel:!1,styles:[{featureType:"all",elementType:"geometry.fill",stylers:[{weight:"2.00"}]},{featureType:"all",elementType:"geometry.stroke",stylers:[{color:"#9c9c9c"}]},{featureType:"all",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#eeeeee"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#7b7b7b"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#c8d7d4"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#070707"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]}]}),r=(new google.maps.Marker({position:new google.maps.LatLng(43.228225,76.898933),map:n,title:sc.site.address,icon:{url:"assets/img/contacts/marker.png",size:new google.maps.Size(26,33),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,33)}}),[new google.maps.LatLng(43.225158,76.89636),new google.maps.LatLng(43.225486,76.899976),new google.maps.LatLng(43.228293,76.899614),new google.maps.LatLng(43.228293,76.899614)]),o=new google.maps.Polyline({path:r,strokeColor:"#ffed00",strokeOpacity:1,strokeWeight:2}),s=new google.maps.DirectionsService,l=[];for(o.setMap(n),i=0;i<r.length-1;i++)s.route({origin:r[i],destination:r[i+1],travelMode:google.maps.DirectionsTravelMode.DRIVING},function(e,t){t==google.maps.DirectionsStatus.OK?(l=l.concat(e.routes[0].overview_path),o.setPath(l)):alert("Directions request failed: "+t)})}}}),app.controller("bodyCtrl",["$scope","$http","$sce","$routeParams","$location",function(e,t,a,o,n){var r=e,s=r.$root;window.sc=r,window.sr=s,r.template=template,s.log=function(e){console.log(e)},s.device=navigator.userAgent.replace(/\)|\(/g,"").split(" "),r.apply=function(e){setTimeout(function(){r.$apply(function(){e()})},70)},s.editContent=function(t){if(void 0!=t.pagetitle){var i=t,o=["pagetitle","longtitle","introtext","description"];for(k2 in o){var n=o[k2],r=i[n];if(void 0!=r&&"string"==typeof r&&-1!=r.indexOf("[")){for(;-1!=r.indexOf("[");)r=r.replace("[","<span>"),r=r.replace("]","</span>");i[n+"Base"]=r,i[n]=a.trustAsHtml(r)}}if(void 0!=i.content&&"string"==typeof i.content&&(i.content=a.trustAsHtml(i.content)),void 0!=i.childs&&i.childs.length)for(kk in i.childs)i.childs[kk]=e.editContent(i.childs[kk]);return 1==i.id&&(i.uri="/"),i}if("array"==typeof t)for(k in t)t[k]=this.editContent(t[k]);return t},s.scrollTo=function(e){var t="string"==typeof e?$(e.replace(/^\/|\/$/g,"")):[],i=+e>=0?+e:0;if(t.length)var i=t.offset().top;$("html,body").animate({scrollTop:i},500)},s.changePage=function(){setTimeout(function(){s.animate.start(),s.pagec.get(),r.apply(function(){s.nav=!1})},300)},r.$on("$routeChangeStart",function(){s.changePage()}),t.get("json/site.json").success(function(e){e.childs=s.editContent(e.childs),r.site=e,s.loading=!1;var t={};for(i=0;i<e.childs.length;i++){var a=e.childs[i];t[a.alias]=a}r.pages=t}),s.trust={html:function(e){return a.trustAsHtml(e)}},s.pagec={get:function(){var e=location.pathname.replace(BASE_PATH, '').replace(/^\/|\/$/g,"");""==e&&(e="home"),r.page=!1,s.loading=!0,void 0!=localStorage.alias&&(e=localStorage.alias),e="json/"+e.replace(/\//g,"_").replace(".html",""),t.get(e+".json").success(function(t){switch(t=s.editContent(t),void 0!=t.pagetitle&&$("head title").html(t.pagetitle),r.page=t,s.loading=!1,e=t.alias,3==t.parent&&(e="project"),r.page.mainId=e,e=t.alias,t.parent){case 3:e="portfolio_more"}r.page.template=e,setTimeout(function(){scrollFn()},300)})}},s.slider={init:function(e,t){if(e){var i=void 0!=e.key&&e.key,a=e.items.length,o=e.limit,n=e.max?e.max:1;if(o){o/=a;var r=parseInt(o);o=o>r?r+1:r,o++}else o=a;this[i]={items:e.items,cout:a,limit:o,unlim:e.unlim,to:"next"};var s=this[i].items;if(s.length)for(r=0;r<n;r++)s[r].active=!0;s[s.length-1].activep=!0,s[s.length>1?n:0].activen=!0}},slide:function(e,t){var a=this[e],o=a.items,n=0;for(i=0;i<o.length;i++)void 0!=o[i].activep&&delete o[i].activep,void 0!=o[i].activen&&delete o[i].activen,o[i].active&&(n=i,delete o[i].active);switch(t){case"next":n=o[n+1]?n+1:0;break;case"prev":n=o[n-1]?n-1:o.length-1;break;default:if(NaN==+t)return;n=+t}a.side=t,o[n].active=!0;var r=o.length-1;o[n>0?n-1:r].activep=!0,o[n<r?n++:0].activen=!0},next:function(e){this.slide(e,"next")},prev:function(e){this.slide(e,"prev")},pos:function(e){return this.list[e].pos},posb:function(e){return this.list[e].posb},to:function(e){return this.list[e].to},getClass:function(e,t){return this.list[e].pos!=t?"":"active"}},s.form={form:$("form:first"),log:function(e){s.log("from."+e)},query:function(e,i){var a=i,i=new FormData;for(k in a)i.append(k,a[k]);t.post(e,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e){s.form.generate(e)})},setForm:function(e,t){return setTimeout(function(){var t="string"==typeof e?$(e):$(e.currentTarget).parents("form");s.form.form=t},150),this},sendPost:function(e){var t=$(e.currentTarget);if(0==t.length)return void this.log("sendPost: "+e+" is undefined");var a=0!=t.parents("form:first").length?t.parents("form:first"):t,o=a.attr("action");if(void 0==o)return void this.log("sendPost: action is undefined");var n=a.find(".data-form").find("input[type=hidden],input[type=text],input[type=password],input[type=checkbox]:checked,input[type=radio]:checked,textarea,select"),r=[];for(i=0;i<n.length;i++){var s=$(n[i]);r[s.attr("name")]=s.val()}this.form=a,this.query(o,r)},generate:function(t){if(void 0!=t){for(k in t)void 0!=this[k]?this[k](t[k]):e.log("fromPost: "+k+" is undefined")}},openModal:function(e,t){var a=$(e.currentTarget),o=void 0!=a.attr("data-target")?$(a.attr("data-target")):$("#modal-request");if(!a.length||!o.length)return void this.log("formModal: t or tm is undefined");var n=!1,n=a.parents("form:first"),r=!!n.length&&n.find("input,textarea,select"),s=o.find(".data-form-hide"),l=void 0!=a.attr("data-type")?a.attr("data-type"):"Заявка на вызов";o.modal("show"),o.find("input[type=text]").val(""),o.find("[name=type]").val(l),s.removeClass(".data-form").hide(),this.form=o.find("form"),this.formClear();var f=o.find("[name=type]");if(f.val(t),r)for(i=0;i<r.length;i++){var f=$(r[i]),d=f.attr("name"),c=f.val();""!=c&&o.find('[name="'+d+'"]').val(c)}var p=void 0!=a.attr("data-keys")&&a.attr("data-keys").split(",");if(p)for(i in p){var m=p[i],f=o.find('[name="'+m+'"]');f.length&&f.parent().addClass("data-form").show()}},formClear:function(e){void 0!=this.captcha&&this.captcha();var t=this.form,a=!(!t&&!t.length)&&t.find(".data-form");if(a)for(i=0;i<a.length;i++){var t=$(a);t.removeClass("has-error"),"full"==e&&(t.find("input[type=text],textarea").val(""),t.find(":checked").prop("checked",!1))}},formActions:function(e,t){if(void 0==t)return void this.log("fromPost."+e+": keys is undefined");var i=this.form;if(!i||0==i.length)return void this.log("formActions."+e+": last post is undefined");this.formClear();for(k in t){var a="formEmpty"==e?t[k]:k,o=i.find(".data-form [name='"+a+"']"),n=1==o.length&&o.parents(".data-form:first");if(n&&n.length&&("formEmpty"!=e||""==o.val())){var r="formEmpty"==e?"обязательная форма":t[k];n.addClass("has-error").find(".data-log").html(r)}}},formEmpty:function(e){this.formActions("formEmpty",e)},formError:function(e){this.formActions("formError",e)},redirect:function(e){location.href=e},message:function(e){if(void 0!=e){var t=$("#modal-message");if(t.length)return s.modal.show("modal-message"),void t.find(".message").html(e);alert(e)}},modalClose:function(e){if(void 0==$().modal)return void this.log(".modalClose: modal plugin is undefined");var t="string"==typeof e?e:".modal";$(t).modal("hide")},captcha:function(e){return},captchaRes:function(e,t){}},s.modal={req:function(e){var t=this;s.afterClick(function(){var i=s.lastClick;if(void 0!=i&&i.length){var a=i.parents("form:first").length?i.parents("form:first"):i,o=void 0!=i.attr("data-target")?$(i.attr("data-target")):$();i.find("[name=type]").val(void 0!=e?e:"Обратный звонок"),s.form.form=o.length?o:a,t.show("modal-request")}})},calc:function(){var e=this;s.afterClick(function(){e.show("modal-calc")})},bactive:!1,active:function(e){return void 0==e?this.bactive:this.bactive==e},aniamtedIn:"fadeInDown",aniamtedOut:"fadeOutUp",show:function(e){r.apply(function(){s.i={animateCube:!0}});var t=$("#"+e);if(t.length){var i=t.find(".modal-content");i.hasClass("animated")||i.addClass("animated"),i.removeClass(this.aniamtedOut).addClass(this.aniamtedIn),t.show(),$("body").css("overflow","hidden"),t.find(".modal-bg").animate({opacity:.5},400)}},hide:function(){var e=$(".modal");if(e.length){e.find(".modal-content").removeClass(this.aniamtedIn).addClass(this.aniamtedOut),e.find(".modal-bg").animate({opacity:0},400,function(){$("body").removeAttr("style"),e.hide()})}}},s.animate={start:function(){if(void 0!=AdobeEdge){var e=this;for(i=0;i<e.items.length;i++)$("."+e.items[i].key).removeClass("active");setTimeout(function(){for(i=0;i<e.items.length;i++){var t=e.items[i];r.page.id==t.id&&e.play(t.key)}},300,e)}},play:function(e){var t=AdobeEdge.getComposition(e);if(void 0!=AdobeEdge&&void 0!=t&&void 0!=t.getStage){var i=t.getStage();if(void 0!=i&&void 0!=i.play){$("."+e).removeClass("active");var t={sel:i,key:e};setTimeout(function(){$("."+t.key).addClass("active"),t.sel.play(0)},300,t)}}},items:[],init:function(e,t,i){if(void 0!=AdobeEdge){this.items.push({id:i,key:e});var a={fn:this,k:t,key:e};setTimeout(function(){a.fn[a.k](a.key)},1e3,a)}},initAfter:function(e,t){void 0==r.page||void 0!=t&&r.page.id!=t||$("."+e).addClass("active")},sneaks:function(e){AdobeEdge.loadComposition("assets/js/izum/sneaks",e,{scaleToFit:"width",centerStage:"horizontal",minW:"0px",maxW:"undefined",width:"550px",height:"400px"},{dom:[]},{dom:[],style:{"${symbolSelector}":{isStage:!0,rect:[void 0,void 0,"550px","400px"],fill:["rgba(255,255,255,1)"]}}}),this.initAfter(e,1),setInterval(function(){1==r.page.id&&s.animate.play(e)},6e4,e)},scared:function(e){AdobeEdge.loadComposition("assets/js/izum/scared",e,{scaleToFit:"none",centerStage:"horizontal",minW:"0px",maxW:"undefined",width:"550px",height:"400px"},{dom:[]},{dom:[],style:{"${symbolSelector}":{isStage:!0,rect:[void 0,void 0,"550px","400px"],fill:["rgba(255,255,255,1)"]}}}),void 0!=r.page&&2!=r.page.id||this.initAfter(e)},jump:function(e){AdobeEdge.loadComposition("assets/js/izum/jump",e,{scaleToFit:"width",centerStage:"horizontal",minW:"0px",maxW:"undefined",width:"550px",height:"400px"},{dom:[]},{dom:[]}),this.initAfter(e,3),setInterval(function(){3==r.page.id&&s.animate.play(e)},6e4,e)},parachute:function(e){var t={self:this,k:e};setTimeout(function(){if(void 0!=r.page.id&&3==r.page.id){AdobeEdge.loadComposition("assets/js/izum/parachute",t.k,{scaleToFit:"none",centerStage:"horizontal",minW:"0px",maxW:"undefined",width:"550px",height:"400px"},{dom:[]},{dom:[],style:{"${symbolSelector}":{isStage:!0,rect:[void 0,void 0,"550px","400px"]}}}),t.self.initAfter(t.k,3);var e=t.k;setInterval(function(){3==r.page.id&&s.animate.play(e)},6e4,e)}},8e3,t)},walk:function(e){AdobeEdge.loadComposition("assets/js/izum/walk",e,{scaleToFit:"none",centerStage:"both",minW:"0px",maxW:"undefined",width:"550px",height:"400px"},{dom:[]},{dom:[],style:{"${symbolSelector}":{isStage:!0,rect:[void 0,void 0,"550px","400px"]}}}),this.initAfter(e,4),setInterval(function(){4==r.page.id&&s.animate.play(e)},6e4,e)},homePaper:function(){var e={self:this,items:r.page.childs[0].images};setTimeout(function(){e.self.homePaperSlide(e.items,0)},300,e)},homePaperSlide:function(e,t){var i={imgs:e,pos:t,self:this};setTimeout(function(){void 0!=e[t+1]&&(r.apply(function(){r.page.childs[0].imagePos=t}),i.self.homePaperSlide(e,t+1))},70,i)}},s.afterClick=function(e){setTimeout(function(){e()},50)}}]),app.controller("partnersCtrl",["$scope",function(e){e.prtns={init:function(e,t){var a=[];for(i=0;i<e.length;i++)a[i]=e[i];t.items=a,this.items.push(t)},items:[],scroll:function(){var t=this;e.$apply(function(){for(i=0;i<t.items.length;i++){var e=t.items[i],a=e.pos,o=e.max,n=e.items,r=0;for(j=0;j<n.length;j++){var s=n[j];delete s.hide,void 0!=s.active&&delete s.active,j>=a*o&&j<a*o+o&&(r++,s.active=r)}a=(a+1)*o<n.length?a+1:0,e.pos=a}})}},setInterval(function(){e.prtns.scroll()},4500,e),setTimeout(function(){e.prtns.scroll()},500,e)}]),$("body").click(function(e){void 0!=sc&&(sr.lastClick=$(e.target))}),window.scrollFn=function(){var e=window.innerWidth,t=window.innerHeight,a=window.scrollY,o=$("header.i-home");o.length&&(a>3*t&&!o.hasClass("active")&&o.addClass("active"),a<t&&o.hasClass("active")&&o.removeClass("active"));var o=$("footer");o.length&&(a>$("body").height()-1.1*t?o.addClass("active"):o.removeClass("active"));var o=$(".navUp");a>t?o.addClass("active"):o.removeClass("active");var o=$("#home .i-paper");if(o.length)if(e>992){var n=(sc.page.childs[0].images,o.height()),r=o.find("div");if(a<2*t){for(o.css({position:"fixed",top:0}),$("#home .i-text").css({position:"fixed",top:0}),r.hide(),i=parseInt(r.length/100*(a/(2.6*n/100)));i>=0;i--)if(void 0!=r[i]){$(r[i]).show();break}}else o.css({position:"absolute",top:2*t}),$("#home .i-text").css({position:"absolute",top:2*t})}else o.removeAttr("style");var a=a+.9*t,s="active-scroll",r=$("["+s+"]");for(i=0;i<r.length;i++){var l=$(r[i]),f=l.offset().top;"true"!=l.attr(s)&&(a>f&&!l.hasClass("active")&&(l.attr(s,"true").addClass("active"),l.attr(s,"false")),a<f&&l.hasClass("active")&&l.attr(s,"false").removeClass("active"))}},$(window).scroll(function(){scrollFn()});
